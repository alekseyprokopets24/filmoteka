"use strict";var renderFilms,ganre,jsScrollBtn=document.querySelector("#js-scroll-btn"),jsList=document.querySelector("#js-list"),pageNumber=1;function scrollTop(){document.body.scrollTop=document.documentElement.scrollTop=0}jsScrollBtn.addEventListener("click",scrollTop);var selectFilm={};function fetchPopularMoviesList(){fetch("https://api.themoviedb.org/3/movie/popular?api_key=8498946f9c7874ef33ac19a931c494c9&language=en-US&page="+"".concat(pageNumber)).then(function(e){if(e.ok)return e.json();throw new Error("Error while fetching: ".concat(e.statusText))}).then(function(e){e.results.forEach(function(e){null!==e.backdrop_path?createCardFunc(e.backdrop_path,e.title,e.id):null!==e.poster_path?createCardFunc(e.poster_path,e.title,e.id):createCardFunc("logo",e.title,e.id)})}).catch(function(e){return console.log(e)})}function createCardFunc(e,t,a){var i=document.createElement("li"),r=document.createElement("img"),n=document.createElement("p");"logo"==e?r.setAttribute("src","./images/logo.png"):r.setAttribute("src","https://image.tmdb.org/t/p/w500"+"".concat(e)),i.setAttribute("js-id","".concat(a)),n.textContent="".concat(t),i.append(r),i.append(n),jsList.append(i),r.classList.add("homePage__img"),i.classList.add("homePage__items"),n.classList.add("homePage__text")}var form=document.querySelector("#homePage__search"),input=document.querySelector("#homePage__search-input"),pagination=document.getElementById("homePage__pagination"),prevBtn=pagination.querySelector('[data-action = "prev"]'),nextBtn=pagination.querySelector('[data-action = "next"]'),pageValue=pagination.querySelector(".homePage__value"),inputValue="";pageValue.textContent=pageNumber;var errorMessage=document.createElement("p");function plaginationNavigation(e){var t=e.target;2===pageNumber&&prevBtn.classList.add("hidden"),t===prevBtn&&(pageNumber-=1,pageValue.textContent=pageNumber,""===inputValue?(jsList.innerHTML="",fetchPopularMoviesList()):fetchFilms(inputValue,pageNumber)),t===nextBtn&&(pageNumber+=1,pageValue.textContent=pageNumber,prevBtn.classList.remove("hidden"),""===inputValue?(jsList.innerHTML="",fetchPopularMoviesList()):fetchFilms(inputValue,pageNumber))}function searchFilms(e){pageNumber=1,e.preventDefault(),errorMessage.hidden=!0,""===(inputValue=input.value)?(jsList.innerHTML="",fetchPopularMoviesList()):fetchFilms(inputValue,pageNumber)}function fetchFilms(a,e){if(""===a)return fetchPopularMoviesList();var t;t=""==a?"https://api.themoviedb.org/3/movie/popular?api_key=8498946f9c7874ef33ac19a931c494c9&language=en-US&page=' + ".concat(e):"\n    https://api.themoviedb.org/3/search/movie?api_key=8498946f9c7874ef33ac19a931c494c9&language=en-US&query=".concat(a,"&page=").concat(e,"&include_adult=false"),fetch(t).then(function(e){return e.json()}).then(function(e){var t=e.results;""!==a&&0===t.length&&(errorMessage.hidden=!1,fetchPopularMoviesList()),jsList.innerHTML="",t.forEach(function(e){null!=e.backdrop_path?createCardFunc(e.backdrop_path,e.title,e.id):null!=e.poster_path?createCardFunc(e.poster_path,e.title,e.id):createCardFunc("logo",e.title,e.id)})}).catch(function(e){return console.log("ERROR"+e)}),input.value=""}errorMessage.setAttribute("id","homePage__search-error-message"),errorMessage.textContent="Sorry, no movie matches your request",errorMessage.hidden=!0,form.append(errorMessage),pagination.addEventListener("click",plaginationNavigation),form.addEventListener("submit",searchFilms);var jsLogo=document.querySelector("#js-logo"),homePageBtn=document.querySelector("#homePage-js"),myLibraryPageBtn=document.querySelector("#myLibraryPage-js"),detailsPageShown=document.querySelector("#detailsPage_show"),myLibraryPageShown=document.querySelector("#myLibraryPage_show"),homePageShown=document.querySelector("#homePage_show");jsList=document.querySelector("#js-list");function showHomePage(){myLibraryPageShown.classList.add("page-disactive"),detailsPageShown.classList.add("page-disactive"),homePageShown.classList.remove("page-disactive"),homePageBtn.classList.add("nav-bar__link-hover"),myLibraryPageBtn.classList.remove("nav-bar__link-hover"),document.title="Home Page",jsList.innerHTML="",fetchPopularMoviesList()}function activeLibraryPage(){homePageShown.classList.add("page-disactive"),detailsPageShown.classList.add("page-disactive"),myLibraryPageShown.classList.remove("page-disactive"),myLibraryPageBtn.classList.add("nav-bar__link-hover"),homePageBtn.classList.remove("nav-bar__link-hover"),cardLibrary.addEventListener("click",activeDetailsPage),drawWatchedFilmList(),document.title="Library Page"}function activeDetailsPage(e){var t=myLibraryPageShown.classList.value;"LI"===e.target.nodeName&&showDetailsPage(e.target.getAttribute("js-id"),!/page-disactive/.test(t))}function showDetailsPage(t,e){if(homePageShown.classList.remove("page-disactive"),detailsPageShown.classList.add("page-disactive"),myLibraryPageShown.classList.add("page-disactive"),e){var a=JSON.parse(localStorage.getItem("filmsQueue")),i=JSON.parse(localStorage.getItem("filmsWatched"));void 0===(selectFilm=i.find(function(e){return e.id==t}))&&(selectFilm=a.find(function(e){return e.id==t})),homePageShown.classList.add("page-disactive"),detailsPageShown.classList.remove("page-disactive"),myLibraryPageShown.classList.add("page-disactive"),showDetails(selectFilm),document.title=selectFilm.title}else{var r="https://api.themoviedb.org/3/movie/".concat(t,"?api_key=8498946f9c7874ef33ac19a931c494c9");fetch(r).then(function(e){return e.json()}).then(function(e){null===(selectFilm=e).poster_path&&(selectFilm.poster_path="./images/logo.png"),document.title=selectFilm.title,homePageShown.classList.add("page-disactive"),detailsPageShown.classList.remove("page-disactive"),myLibraryPageShown.classList.add("page-disactive"),showDetails(selectFilm)}).catch(function(e){return console.log(e)})}}window.onload=showHomePage(),jsLogo.addEventListener("click",showHomePage),myLibraryPageBtn.addEventListener("click",activeLibraryPage),homePageBtn.addEventListener("click",showHomePage),jsList.addEventListener("click",activeDetailsPage);var btnWatched=document.querySelector("#btn--watched"),btnQueue=document.querySelector("#btn--queue"),ThisMovie={watched:!0,queue:!0};function showDetails(a){var e=document.querySelector("#js-popularity"),t=document.querySelector("#js-origin-title"),i=document.querySelector("#js-vote"),r=document.querySelector("#js-votes-count"),n=document.querySelector("#js-genre"),o=document.querySelector("#js-description"),c=document.querySelector("#js-Film-title"),s=document.querySelector("#js-poster"),l=" ";null!=a.genres&&null!=a.genres&&(a.genres.forEach(function(e,t){l+=e.name,t!=a.genres.length-1&&(l+=", ")}),e.textContent=a.popularity,t.textContent=a.original_title,i.textContent=a.vote_average,r.textContent=a.vote_count,c.textContent=a.title,o.textContent=a.overview,n.textContent=l,"./images/logo.png"==a.poster_path?s.setAttribute("src","./images/logo.png"):s.setAttribute("src","https://image.tmdb.org/t/p/w500".concat(a.poster_path)),monitorButtonStatusText())}function monitorButtonStatusText(){isVarInLocalstorage("filmsQueue",selectFilm.id)?(btnQueue.firstChild.setAttribute("src","./images/calendar-minus.png"),btnQueue.lastChild.textContent="Remove from queue",ThisMovie.queue=!0):(btnQueue.firstChild.setAttribute("src","./images/calendar-plus.png"),btnQueue.lastChild.textContent="Add to queue",ThisMovie.queue=!1),isVarInLocalstorage("filmsWatched",selectFilm.id)?(btnWatched.firstChild.setAttribute("src","./images/delete-video.png"),btnWatched.lastChild.textContent="Remove from watched",ThisMovie.watched=!0):(btnWatched.firstChild.setAttribute("src","./images/video.png"),btnWatched.lastChild.textContent="Add to watched",ThisMovie.watched=!1)}function adtiveAddingBtn(e,t){var a=JSON.parse(localStorage.getItem(e));null==a&&(a=[]),t?a=a.filter(function(e){return e.id!=selectFilm.id}):a.push(selectFilm),localStorage.setItem(e,JSON.stringify(a)),monitorButtonStatusText()}function isVarInLocalstorage(e,t){var a=JSON.parse(localStorage.getItem(e));return null==a?!(a=[]):null!=a.find(function(e){return e.id==t})}btnQueue.addEventListener("click",function(){adtiveAddingBtn("filmsQueue",ThisMovie.queue)}),btnWatched.addEventListener("click",function(){adtiveAddingBtn("filmsWatched",ThisMovie.watched)});var cardLibrary=document.querySelector(".library__list"),libraryButtonWatch=document.querySelector(".library__btn--watch"),libraryButtonQueue=document.querySelector(".library__btn--queue");function drawWatchedFilmList(){libraryButtonWatch.classList.add("library__btn--active"),libraryButtonQueue.classList.remove("library__btn--active"),cardLibrary.innerHTML="";var e=JSON.parse(localStorage.getItem("filmsWatched"));null==e||0===e.length?cardLibrary.innerHTML="<p class='text-warning'>You do not have watched movies. Add them.</p>":e.forEach(function(e){null!=e.backdrop_path?createLibraryCardFunc(e.backdrop_path,e.title,e.id,e.vote_average):createLibraryCardFunc(e.poster_path,e.title,e.id,e.vote_average)})}function drawQueueFilmList(){libraryButtonWatch.classList.remove("library__btn--active"),libraryButtonQueue.classList.add("library__btn--active"),cardLibrary.innerHTML="";var e=JSON.parse(localStorage.getItem("filmsQueue"));null==e||0===e.length?cardLibrary.innerHTML="<p class='text-warning'>You do not have to queue movies to watch. Add them. </p>":e.forEach(function(e){null!=e.backdrop_path?createLibraryCardFunc(e.backdrop_path,e.title,e.id,e.vote_average):createLibraryCardFunc(e.poster_path,e.title,e.id,e.vote_average)})}function createLibraryCardFunc(e,t,a,i){var r;r="./images/logo.png"==e?"./images/logo.png":"https://image.tmdb.org/t/p/w500".concat(e);var n='<li class ="library__list-item" js-id="'.concat(a,'">\n<img src="').concat(r,'"  alt="poster film">\n\n<p class="library__vote">').concat(i,'</p>\n<p class="library__nameFilm">').concat(t,"</p>\n</li>");cardLibrary.innerHTML+=n}libraryButtonWatch.addEventListener("click",drawWatchedFilmList),libraryButtonQueue.addEventListener("click",drawQueueFilmList);